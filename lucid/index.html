<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title></title>
  </head>
  <body>
    <script type="module">
      import {
        Lucid,
        Blockfrost,
        utf8ToHex,
        toUnit,
        Data,
        Constr,
        fromHex,
        toHex,
        sha256,
      } from "https://unpkg.com/lucid-cardano@0.7.0/web/mod.js";
      const lucid = await Lucid.new(
        new Blockfrost(
          "https://cardano-preview.blockfrost.io/api/v0",
          "previewCuKgDj1hQgDyMMcsbLKSt8GOKXDIGbv2"
        ),
        "Preview"
      );
      import * as cbor from "https://deno.land/x/cbor@v1.4.1/index.js";

      import data from "../plutus.json" assert { type: "json" };
      console.log(data);

      const hyperSpaceScript = {
        type: "PlutusV2",
        script: toHex(cbor.encode(fromHex(data.validators[0].compiledCode))),
      };

      var policyidScript = {
        type: "PlutusV2",
        script: toHex(cbor.encode(fromHex(data.validators[2].compiledCode))),
      };

      var policyId = lucid.utils.mintingPolicyToId(policyidScript);
      console.log("policy NFT");
      console.log(policyId);

      const validatorHash = lucid.utils.validatorToScriptHash(hyperSpaceScript);
      console.log("validator hash");
      console.log(validatorHash);
      const CredentialSC = lucid.utils.scriptHashToCredential(validatorHash);
      const addressRequest = lucid.utils.credentialToAddress(CredentialSC);
      console.log("address of request");
      console.log(addressRequest);
      let api = undefined;
      window.connect = async function connect(wallet) {
        api = await window.cardano[wallet].enable();
        localStorage.setItem("wallet", wallet);
      };

      var wallet = "nami";
      api = await window.cardano[wallet].enable();
      lucid.selectWallet(api);
      window.owner = await lucid.wallet.address();
      const { paymentCredential, stakeCredential } =
        lucid.utils.getAddressDetails(await lucid.wallet.address());
      console.log("credentials");
      console.log(paymentCredential.hash);
      console.log(stakeCredential.hash);

      var unitNFT = policyId + "7374617274696e674e4654"; //new nft policyid made from minter aiken and enceded name matching old asset
      var oldNFT =
        "46ed3232d6a2784eaff3690aff2ac7bdd1e8a864a825fdc98f346e9b7374617274696e674e4654"; //policyId + asset name (hex encoded)

      var redeemerRequest = Data.to(new Constr(0, ["7374617274696e674e4654"]));

      var datumRequest = Data.to(new Constr(0, []));

      var nfts = {};
      nfts[oldNFT] = 1n;

      const tx = await lucid
        .newTx()
        .payToContract(addressRequest, { inline: datumRequest }, nfts)
        .mintAssets({ [unitNFT]: 1n }, redeemerRequest)
        .attachMintingPolicy(policyidScript)
        .complete();

      const signedTx = await tx.sign().complete();
      const txHash = await signedTx.submit();
      console.log(txHash);
    </script>

    <h1>TEST YO YO YO</h1>
  </body>
</html>
